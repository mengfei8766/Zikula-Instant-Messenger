var Tooltips=Class.create();Tooltips.prototype={initialize:function(selector,options){var tooltips=$$(selector);tooltips.each(function(tooltip){new Tooltip(tooltip,options)})}};var Tooltip=Class.create();Tooltip.prototype={initialize:function(el,options){this.el=$(el);this.initialized=false;this.setOptions(options);this.showEvent=this.show.bindAsEventListener(this);this.hideEvent=this.hide.bindAsEventListener(this);this.updateEvent=this.update.bindAsEventListener(this);Event.observe(this.el,"mouseover",this.showEvent);Event.observe(this.el,"mouseout",this.hideEvent);if(options&&options.content){this.content=$(options.content).innerHTML}else{this.content=this.el.title.stripScripts().strip()}this.content=this.el.title.stripScripts().strip();this.el.title="";this.el.descendants().each(function(el){if(Element.readAttribute(el,"alt")){el.alt=""}})},setOptions:function(options){this.options={backgroundColor:"#999",borderColor:"#666",textColor:"",textShadowColor:"",maxWidth:250,align:"left",delay:250,mouseFollow:true,opacity:0.75,appearDuration:0.25,hideDuration:0.25};Object.extend(this.options,options||{})},show:function(e){this.xCord=Event.pointerX(e);this.yCord=Event.pointerY(e);if(!this.initialized){this.timeout=window.setTimeout(this.appear.bind(this),this.options.delay)}},hide:function(e){if(this.initialized){this.appearingFX.cancel();if(this.options.mouseFollow){Event.stopObserving(this.el,"mousemove",this.updateEvent)}new Effect.Fade(this.tooltip,{duration:this.options.hideDuration,afterFinish:function(){Element.remove(this.tooltip)}.bind(this)})}this._clearTimeout(this.timeout);this.initialized=false},update:function(e){this.xCord=Event.pointerX(e);this.yCord=Event.pointerY(e);this.setup()},appear:function(){this.tooltip=new Element("div",{className:"tooltip",style:"display: none"});var arrow=new Element("div",{className:"xarrow"}).insert('<b class="a1"></b><b class="a2"></b><b class="a3"></b><b class="a4"></b><b class="a5"></b><b class="a6"></b>');var top=new Element("div",{className:"xtop"}).insert(new Element("div",{className:"xb1",style:"background-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb2",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb3",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb4",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"}));var bottom=new Element("div",{className:"xbottom"}).insert(new Element("div",{className:"xb4",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb3",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb2",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+";"})).insert(new Element("div",{className:"xb1",style:"background-color:"+this.options.borderColor+";"}));var content=new Element("div",{className:"xboxcontent",style:"background-color:"+this.options.backgroundColor+"; border-color:"+this.options.borderColor+((this.options.textColor!="")?"; color:"+this.options.textColor:"")+((this.options.textShadowColor!="")?"; text-shadow:2px 2px 0"+this.options.textShadowColor+";":"")}).update(this.content);this.tooltip.insert(arrow).insert(top).insert(content).insert(bottom);$(document.body).insert({top:this.tooltip});this.tooltip.select(".xarrow b").each(function(el){if(!el.hasClassName("a1")){el.setStyle({backgroundColor:this.options.backgroundColor,borderColor:this.options.borderColor})}else{el.setStyle({backgroundColor:this.options.borderColor})}}.bind(this));Element.extend(this.tooltip);this.options.width=this.tooltip.getWidth()+1;this.tooltip.style.width=this.options.width+"px";this.setup();if(this.options.mouseFollow){Event.observe(this.el,"mousemove",this.updateEvent)}this.initialized=true;this.appearingFX=new Effect.Appear(this.tooltip,{duration:this.options.appearDuration,to:this.options.opacity})},setup:function(){if(this.options.width>this.options.maxWidth){this.options.width=this.options.maxWidth;this.tooltip.style.width=this.options.width+"px"}if(this.xCord+this.options.width>=Element.getWidth(document.body)){this.options.align="right";this.xCord=this.xCord-this.options.width+20;this.tooltip.down(".xarrow").setStyle({left:this.options.width-24+"px"})}else{this.options.align="left";this.tooltip.down(".xarrow").setStyle({left:12+"px"})}this.tooltip.style.left=this.xCord-7+"px";this.tooltip.style.top=this.yCord+12+"px"},_clearTimeout:function(timer){clearTimeout(timer);clearInterval(timer);return null}};